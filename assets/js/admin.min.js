!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t,a){},function(e,t,a){"use strict";a.r(t);a(0);var n=class{constructor(){return $("td.actions").each((e,t)=>{let a=$("> a",t);a.length>3&&a.addClass("btn-block")}),this}};class r{constructor(){return $(".js-admin-notes").each((e,t)=>{let a=$(t),n=$("<span>").addClass("admin-notes__counter"),r=a.data("model-name"),i=a.data("model-provider"),d=a.data("id"),o=a.data("modal-title")||"Notes",s=a.data("modal-width")||500,l=a.data("modal-max-height")||750;a.append(n).on("click",()=>{let e=$("<div>").dialog({modal:!0,title:o,width:s,maxHeight:l,position:{my:"center",at:"center",of:window}});return this.load(e,r,i,d),!1}),this.countNotes(r,i,d).done(e=>{this.setCounter(e)})}),this}load(e,t,a,n){e.html($("<p>").text("Loading...")),this.loadNotes(t,a,n).done(r=>{let i=$("<ul>").addClass("admin-notes"),d=$("<li>").addClass("admin-notes__empty").append($("<p>").text("No notes recorded for this item"));if(i.append(d),r.data.length){d.hide();for(let t=0,a=r.data.length;t<a;t++)i.append(this.renderMessageItem(e,r.data[t].id,r.data[t].message,r.data[t].user,r.data[t].date))}let o=$("<li>"),s=$("<textarea>"),l=$("<button>").addClass("btn btn-block btn-primary").text("Add Note").on("click",()=>{this.saveNote(t,a,n,s.val()).done(t=>{s.val(""),$(".admin-notes__empty",e).hide(),o.before(this.renderMessageItem(e,t.data.id,t.data.message,t.data.user,t.data.date)),this.setCounter(e.length).centerModal(e,!0)})});i.append(o.append(s).append(l)),e.html(i),this.centerModal(e,!0)})}centerModal(e,t){return e.dialog("option","position",{my:"center",at:"center",of:window}),t&&e.animate({scrollTop:e.find(".admin-notes").outerHeight()},200),this}countNotes(e,t,a){let n=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/note/count",data:{model_name:e,model_provider:t,item_id:a}}).done(e=>{n.resolve(e.data)}).fail(e=>{r.showError(e.responseText),n.reject(e.responseText)}),n.promise()}loadNotes(e,t,a){let n=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/note",data:{model_name:e,model_provider:t,item_id:a}}).done(e=>{n.resolve(e)}).fail(e=>{r.showError(e.responseText),n.reject(e.responseText)}),n.promise()}saveNote(e,t,a,n){let i=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/note",method:"POST",data:{model_name:e,model_provider:t,item_id:a,message:n}}).done(e=>{i.resolve(e)}).fail(e=>{r.showError(e.responseText),i.reject(e.responseText)}),i.promise()}deleteNote(e){let t=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/note/"+e,method:"DELETE"}).done(e=>{t.resolve(e)}).fail(e=>{r.showError(e.responseText),t.reject(e.responseText)}),t.promise()}renderMessageItem(e,t,a,n,r){let i=$("<li>").addClass("admin-notes__note"),d=$("<div>").addClass("admin-notes__note__message").html(a),o=$("<button>").addClass("admin-notes__note__delete").html("&times;"),s=$("<div>").addClass("admin-notes__note__meta"),l=$("<span>").addClass("admin-notes__note__meta__user").html(n.first_name+" "+n.last_name),c=$("<span>").addClass("admin-notes__note__meta__date").html(r);return o.on("click",()=>(this.deleteNote(t).done(()=>{i.remove(),this.centerModal(e,!1);let t=$(".admin-notes__note",e).length;this.setCounter(t),0===t&&$(".admin-notes__empty",e).show()}),!1)),i.append(d).append(o).append(s.append(l).append(c))}setCounter(e){return $(".admin-notes__counter").text(e||""),this}static showError(e){let t;try{t=JSON.parse(e)}catch(e){t={error:"An unknown error occurred"}}alert(t.error)}}var i=r;class d{constructor(e){this.$input=$(e),this.api=this.$input.data("api"),this.isMultiple=this.$input.data("multiple")||!1,this.isClearable=this.$input.data("clearable")||!0,this.placeholder=this.$input.data("placeholder")||"Search for an item",this.minLength=this.$input.data("min-length")||2,this.api?this.$input.select2({placeholder:this.placeholder,minimumInputLength:this.minLength,multiple:this.isMultiple,allowClear:this.isClearable,ajax:{url:window.SITE_URL+"api/"+this.api,dataType:"json",quietMillis:250,data:e=>({search:e}),results:e=>({results:this.formatResults(e.data)}),cache:!0},initSelection:(e,t)=>{let a=$(e).val();""!==a&&this.isMultiple?$.ajax({url:window.SITE_URL+"api/"+this.api+"?ids="+a,dataType:"json"}).done(e=>{t(this.formatResults(e.data))}):""!==a&&$.ajax({url:window.SITE_URL+"api/"+this.api+"/"+a,dataType:"json"}).done(e=>{t(this.formatResult(e.data))})}}):console.warn("Element is configured as a Searcher but no model or provider has been defined",this.$input)}formatResults(e){let t=[];for(let a=0;a<e.length;a++)t.push(this.formatResult(e[a]));return t}formatResult(e){return{id:e.id,text:e.label}}}var o=class{constructor(){$(".js-searcher").each((e,t)=>{$(t).data("searcher",new d(t))})}};var s=class{constructor(){return $(".js-admin-sortable").each(function(){let e=$(this),t=e.data("handle")||null,a=e.data("axis")||"y",n=e.data("containment")||"parent";e.sortable({handle:t,axis:a,containment:n,forceHelperSize:!0,helper:function(e,t){let a=t.children(),n=t.clone();return n.children().each(function(e){$(this).width(a.eq(e).outerWidth())}),n},stop:function(){e.find(".js-admin-sortable__order").each(function(e){$(this).val(e)})}})}),this}};let l;new class{constructor(){return $(".js-admin-dynamic-table").each((e,t)=>{this.init($(t))}),this}init(e){e.trigger("dynamic-table:starting");let t=e.find(".js-admin-dynamic-table__template"),a=e.data("data")||[];e.data("template",t.html()),e.data("index",0),t.empty(),this.bindEvents(e,t);for(let n=0,r=a.length;n<r;n++)this.add(e,t,a[n]);return e.trigger("dynamic-table:ready"),this}bindEvents(e,t){return $(".js-admin-dynamic-table__add",e).on("click",()=>(this.add(e,t),!1)),e.on("click",".js-admin-dynamic-table__remove",t=>(this.remove(e,$(t.currentTarget).closest("tr")),!1)),this}add(e,t,a){(a=a||{}).index=e.data("index")||0;let n=$(Mustache.render(e.data("template"),a));return $("select",n).each((e,t)=>{let a=$(t);if(a[0].hasAttribute("data-dynamic-table-value")){let e=a.data("dynamic-table-value");$('option[value="'+e+'"]',a).prop("selected",!0)}a.css("width","100%").select2()}),t.append(n),e.data("index",a.index+1),e.trigger("dynamic-table:add"),this}remove(e,t){return t.remove(),e.trigger("dynamic-table:add"),this}},new n,new i,new o,l=void new s}]);