!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t,a){},,function(e,t,a){"use strict";a.r(t);a(0);var n=class{constructor(){return $(".js-admin-sortable").each(function(){let e=$(this),t=e.data("handle")||null,a=e.data("axis")||"y",n=e.data("containment")||"parent";e.sortable({handle:t,axis:a,containment:n,forceHelperSize:!0,helper:function(e,t){let a=t.children(),n=t.clone();return n.children().each(function(e){$(this).width(a.eq(e).outerWidth())}),n},stop:function(){e.find(".js-admin-sortable__order").each(function(e){$(this).val(e)})}})}),this}};var r=class{constructor(){return $("td.actions").each((e,t)=>{let a=$("> a",t);a.length>3&&a.addClass("btn-block")}),this}};class d{constructor(){return $(".js-admin-notes").each((e,t)=>{let a=$(t),n=$("<span>").addClass("admin-notes__counter"),r=a.data("model-name"),d=a.data("model-provider"),o=a.data("id"),s=a.data("modal-title")||"Notes",i=a.data("modal-width")||500,l=a.data("modal-max-height")||750;a.append(n).on("click",()=>{let e=$("<div>").dialog({modal:!0,title:s,width:i,maxHeight:l});return this.load(e,n,r,d,o),!1}),this.countNotes(r,d,o).done(e=>{n.text(e||"")})}),this}load(e,t,a,n,r){e.html($("<p>").text("Loading...")),this.loadNotes(a,n,r).done(o=>{let s=$("<ul>").addClass("admin-notes");if(o.data.length)for(let e=0,t=o.data.length;e<t;e++)s.append(d.renderMessageItem(o.data[e].message,o.data[e].user,o.data[e].date));else s.append($("<li>").addClass("admin-notes__empty").append($("<p>").text("No notes recorded for this item")));let i=$("<li>"),l=$("<textarea>"),c=$("<button>").addClass("btn btn-block btn-primary").text("Add Note").on("click",()=>{this.saveNote(a,n,r,l.val()).done(a=>{l.val(""),$(".admin-notes__empty",e).remove(),i.before(d.renderMessageItem(a.data.message,a.data.user,a.data.date)),t.text($(".admin-notes__note",e).length||""),e.dialog("option","position","center")})});s.append(i.append(l).append(c)),e.html(s)})}countNotes(e,t,a){let n=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes/count",data:{model_name:e,model_provider:t,id:a}}).done(e=>{n.resolve(e.data)}).fail(e=>{d.showError(e.responseText),n.reject(e.responseText)}),n.promise()}loadNotes(e,t,a){let n=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes",data:{model_name:e,model_provider:t,id:a}}).done(e=>{n.resolve(e)}).fail(e=>{d.showError(e.responseText),n.reject(e.responseText)}),n.promise()}saveNote(e,t,a,n){let r=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes",method:"POST",data:{model_name:e,model_provider:t,id:a,message:n}}).done(e=>{r.resolve(e)}).fail(e=>{d.showError(e.responseText),r.reject(e.responseText)}),r.promise()}static renderMessageItem(e,t,a){let n=$("<div>").addClass("admin-notes__note__message").html(e),r=$("<div>").addClass("admin-notes__note__meta"),d=$("<span>").addClass("admin-notes__note__meta__user").html(t.first_name+" "+t.last_name),o=$("<span>").addClass("admin-notes__note__meta__date").html(a);return $("<li>").addClass("admin-notes__note").append(n).append(r.append(d).append(o))}static showError(e){let t;try{t=JSON.parse(e)}catch(e){t={error:"An unknown error occurred"}}alert(t.error)}}var o=d;let s;new class{constructor(){return $(".js-admin-dynamic-table").each((e,t)=>{this.init($(t))}),this}init(e){let t=e.find(".js-admin-dynamic-table__template"),a=e.data("data")||[];e.data("template",t.html()),e.data("index",0),t.empty(),this.bindEvents(e,t);for(let n=0,r=a.length;n<r;n++)this.add(e,t,a[n]);return this}bindEvents(e,t){return $(".js-admin-dynamic-table__add",e).on("click",()=>(this.add(e,t),!1)),e.on("click",".js-admin-dynamic-table__remove",e=>(this.remove($(e.currentTarget).closest("tr")),!1)),this}add(e,t,a){return(a=a||{}).index=e.data("index")||0,t.append(Mustache.render(e.data("template"),a)),e.data("index",a.index+1),this}remove(e){return e.remove(),this}},new n,new r,s=void new o}]);