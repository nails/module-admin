!function(){function e(n,t,a){function o(i,d){if(!t[i]){if(!n[i]){var s="function"==typeof require&&require;if(!d&&s)return s(i,!0);if(r)return r(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return o(t||e)},l,l.exports,e,n,t,a)}return t[i].exports}for(var r="function"==typeof require&&require,i=0;i<a.length;i++)o(a[i]);return o}return e}()({1:[function(e,n,t){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var o=e("./components/DynamicTable.js"),r=a(o),i=e("./components/Sortable.js"),d=a(i),s=e("./components/IndexButtons.js"),u=a(s),l=e("./components/Notes.js"),c=a(l),f=void 0;f=function(){new r["default"],new d["default"],new u["default"],new c["default"]}()},{"./components/DynamicTable.js":2,"./components/IndexButtons.js":3,"./components/Notes.js":4,"./components/Sortable.js":5}],2:[function(e,n,t){"use strict";function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),r=function(){function e(){var n=this;return a(this,e),$(".js-admin-dynamic-table").each(function(e,t){n.init($(t))}),this}return o(e,[{key:"init",value:function(e){var n=e.find(".js-admin-dynamic-table__template"),t=e.data("data")||[];e.data("template",n.html()),e.data("index",0),n.empty(),this.bindEvents(e,n);for(var a=0,o=t.length;a<o;a++)this.add(e,n,t[a]);return this}},{key:"bindEvents",value:function(e,n){var t=this;return $(".js-admin-dynamic-table__add",e).on("click",function(){return t.add(e,n),!1}),e.on("click",".js-admin-dynamic-table__remove",function(e){return t.remove($(e.currentTarget).closest("tr")),!1}),this}},{key:"add",value:function(e,n,t){return t=t||{},t.index=e.data("index")||0,n.append(Mustache.render(e.data("template"),t)),e.data("index",t.index+1),this}},{key:"remove",value:function(e){return e.remove(),this}}]),e}();t["default"]=r},{}],3:[function(e,n,t){"use strict";function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function r(){return a(this,r),$("td.actions").each(function(e,n){var t=$("> a",n);t.length>3&&t.addClass("btn-block")}),this};t["default"]=o},{}],4:[function(e,n,t){"use strict";function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),r=function(){function e(){var n=this;return a(this,e),$(".js-admin-notes").each(function(e,t){var a=$(t),o=$("<span>").addClass("admin-notes__counter"),r=a.data("model-name"),i=a.data("model-provider"),d=a.data("id"),s=a.data("modal-title")||"Notes",u=a.data("modal-width")||500,l=a.data("modal-max-height")||750;a.append(o).on("click",function(){var e=$("<div>").dialog({modal:!0,title:s,width:u,maxHeight:l});return n.load(e,r,i,d),!1}),n.countNotes(r,i,d).done(function(e){o.val(e)})}),this}return o(e,[{key:"load",value:function(n,t,a,o){var r=this;n.html($("<p>").text("Loading...")),base.loadNotes(t,a,o).done(function(i){var d=$("<ul>").addClass("admin-notes");if(i.data.length)for(var s=0,u=i.data.length;s<u;s++)d.append(e.renderMessageItem(i.data[s].message,i.data[s].user,i.data[s].date));else d.append($("<li>").addClass("admin-notes__empty").append($("<p>").text("No notes recorded for this item")));var l=$("<li>"),c=$("<textarea>"),f=$("<button>").addClass("btn btn-block btn-primary").text("Add Note").on("click",function(){r.saveNote(t,a,o,c.val()).done(function(t){c.val(""),$(".admin-notes__empty",n).remove(),l.before(e.renderMessageItem(t.data.message,t.data.user,t.data.date)),n.dialog("option","position","center")})});d.append(l.append(c).append(f)),n.html(d)})}},{key:"countNotes",value:function(n,t,a){var o=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes/count",data:{model_name:n,model_provider:t,id:a}}).done(function(e){o.resolve(e.data)}).fail(function(n){e.showError(n.responseText),o.reject(n.responseText)}),o.promise()}},{key:"loadNotes",value:function(n,t,a){var o=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes",data:{model_name:n,model_provider:t,id:a}}).done(function(e){o.resolve(e)}).fail(function(n){e.showError(n.responseText),o.reject(n.responseText)}),o.promise()}},{key:"saveNote",value:function(n,t,a,o){var r=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes",method:"POST",data:{model_name:n,model_provider:t,id:a,message:o}}).done(function(e){r.resolve(e)}).fail(function(n){e.showError(n.responseText),r.reject(n.responseText)}),r.promise()}}],[{key:"renderMessageItem",value:function(e,n,t){var a=$("<div>").addClass("admin-notes__note__message").html(e),o=$("<div>").addClass("admin-notes__note__meta"),r=$("<span>").addClass("admin-notes__note__meta__user").html(n.first_name+" "+n.last_name),i=$("<span>").addClass("admin-notes__note__meta__date").html(t);return $("<li>").addClass("admin-notes__note").append(a).append(o.append(r).append(i))}},{key:"showError",value:function(e){var n=void 0;try{n=JSON.parse(e)}catch(t){n={error:"An unknown error occurred"}}alert(n.error)}}]),e}();t["default"]=r},{}],5:[function(e,n,t){"use strict";function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function r(){return a(this,r),$(".js-admin-sortable").each(function(){var e=$(this),n=e.data("handle")||null,t=e.data("axis")||"y",a=e.data("containment")||"parent";e.sortable({handle:n,axis:t,containment:a,forceHelperSize:!0,helper:function(e,n){var t=n.children(),a=n.clone();return a.children().each(function(e){$(this).width(t.eq(e).outerWidth())}),a},stop:function(){e.find(".js-admin-sortable__order").each(function(e){$(this).val(e)})}})}),this};t["default"]=o},{}]},{},[1]);
//# sourceMappingURL=admin.min.js.map
