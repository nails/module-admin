!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t,a){},,function(e,t,a){"use strict";a.r(t);a(0);var n=class{constructor(){return $("td.actions").each((e,t)=>{let a=$("> a",t);a.length>3&&a.addClass("btn-block")}),this}};class r{constructor(){return $(".js-admin-notes").each((e,t)=>{let a=$(t),n=$("<span>").addClass("admin-notes__counter"),r=a.data("model-name"),i=a.data("model-provider"),s=a.data("id"),d=a.data("modal-title")||"Notes",o=a.data("modal-width")||500,l=a.data("modal-max-height")||750;a.append(n).on("click",()=>{let e=$("<div>").dialog({modal:!0,title:d,width:o,maxHeight:l});return this.load(e,n,r,i,s),!1}),this.countNotes(r,i,s).done(e=>{n.text(e||"")})}),this}load(e,t,a,n,i){e.html($("<p>").text("Loading...")),this.loadNotes(a,n,i).done(s=>{let d=$("<ul>").addClass("admin-notes");if(s.data.length)for(let e=0,t=s.data.length;e<t;e++)d.append(r.renderMessageItem(s.data[e].message,s.data[e].user,s.data[e].date));else d.append($("<li>").addClass("admin-notes__empty").append($("<p>").text("No notes recorded for this item")));let o=$("<li>"),l=$("<textarea>"),u=$("<button>").addClass("btn btn-block btn-primary").text("Add Note").on("click",()=>{this.saveNote(a,n,i,l.val()).done(a=>{l.val(""),$(".admin-notes__empty",e).remove(),o.before(r.renderMessageItem(a.data.message,a.data.user,a.data.date)),t.text($(".admin-notes__note",e).length||""),e.dialog("option","position","center")})});d.append(o.append(l).append(u)),e.html(d)})}countNotes(e,t,a){let n=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes/count",data:{model_name:e,model_provider:t,id:a}}).done(e=>{n.resolve(e.data)}).fail(e=>{r.showError(e.responseText),n.reject(e.responseText)}),n.promise()}loadNotes(e,t,a){let n=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes",data:{model_name:e,model_provider:t,id:a}}).done(e=>{n.resolve(e)}).fail(e=>{r.showError(e.responseText),n.reject(e.responseText)}),n.promise()}saveNote(e,t,a,n){let i=new $.Deferred;return $.ajax({url:window.SITE_URL+"api/admin/notes",method:"POST",data:{model_name:e,model_provider:t,id:a,message:n}}).done(e=>{i.resolve(e)}).fail(e=>{r.showError(e.responseText),i.reject(e.responseText)}),i.promise()}static renderMessageItem(e,t,a){let n=$("<div>").addClass("admin-notes__note__message").html(e),r=$("<div>").addClass("admin-notes__note__meta"),i=$("<span>").addClass("admin-notes__note__meta__user").html(t.first_name+" "+t.last_name),s=$("<span>").addClass("admin-notes__note__meta__date").html(a);return $("<li>").addClass("admin-notes__note").append(n).append(r.append(i).append(s))}static showError(e){let t;try{t=JSON.parse(e)}catch(e){t={error:"An unknown error occurred"}}alert(t.error)}}var i=r;class s{constructor(e){this.$input=$(e),this.api=this.$input.data("api"),this.isMultiple=this.$input.data("multiple")||!1,this.isClearable=this.$input.data("clearable")||!0,this.placeholder=this.$input.data("placeholder")||"Search for an item",this.minLength=this.$input.data("min-length")||2,this.api?this.$input.select2({placeholder:this.placeholder,minimumInputLength:this.minLength,multiple:this.isMultiple,allowClear:this.isClearable,ajax:{url:window.SITE_URL+"api/"+this.api,dataType:"json",quietMillis:250,data:e=>({search:e}),results:e=>({results:this.formatResults(e.data)}),cache:!0},initSelection:(e,t)=>{let a=$(e).val();""!==a&&this.isMultiple?$.ajax({url:window.SITE_URL+"api/"+this.api+"?ids="+a,dataType:"json"}).done(e=>{t(this.formatResults(e.data))}):""!==a&&$.ajax({url:window.SITE_URL+"api/"+this.api+"/"+a,dataType:"json"}).done(e=>{t(this.formatResult(e.data))})}}):console.warn("Element is configured as a Searcher but no model or provider has been defined",this.$input)}formatResults(e){let t=[];for(let a=0;a<e.length;a++)t.push(this.formatResult(e[a]));return t}formatResult(e){return{id:e.id,text:e.label}}}var d=class{constructor(){$(".js-searcher").each((e,t)=>{$(t).data("searcher",new s(t))})}};var o=class{constructor(){return $(".js-admin-sortable").each(function(){let e=$(this),t=e.data("handle")||null,a=e.data("axis")||"y",n=e.data("containment")||"parent";e.sortable({handle:t,axis:a,containment:n,forceHelperSize:!0,helper:function(e,t){let a=t.children(),n=t.clone();return n.children().each(function(e){$(this).width(a.eq(e).outerWidth())}),n},stop:function(){e.find(".js-admin-sortable__order").each(function(e){$(this).val(e)})}})}),this}};let l;new class{constructor(){return $(".js-admin-dynamic-table").each((e,t)=>{this.init($(t))}),this}init(e){let t=e.find(".js-admin-dynamic-table__template"),a=e.data("data")||[];e.data("template",t.html()),e.data("index",0),t.empty(),this.bindEvents(e,t);for(let n=0,r=a.length;n<r;n++)this.add(e,t,a[n]);return this}bindEvents(e,t){return $(".js-admin-dynamic-table__add",e).on("click",()=>(this.add(e,t),!1)),e.on("click",".js-admin-dynamic-table__remove",e=>(this.remove($(e.currentTarget).closest("tr")),!1)),this}add(e,t,a){return(a=a||{}).index=e.data("index")||0,t.append(Mustache.render(e.data("template"),a)),e.data("index",a.index+1),this}remove(e){return e.remove(),this}},new n,new i,new d,l=void new o}]);